"use strict";var _createClass=function(){function a(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.prototype.prepend=function(t){return this.innerHTML=t+this.innerHTML,this};var loop=function(){},Carousel=function(){function e(t){_classCallCheck(this,e),this.attrs={warp:t.warp,main:t.main,startPos:"",endPos:"",play:t.play||!1,time:t.time||3e3,horizontal:t.horizontal||!1,point:t.point||!1,pointColor:t.pointColor||"blue",pointSize:t.pointSize||"6px",touch:t.touch||!1,half:t.half||null},this.index=0}return _createClass(e,[{key:"init",value:function(){var n=this;this._warp=document.querySelector("."+this.attrs.warp),this._main=document.querySelectorAll("."+this.attrs.main),this._mainLen=this._main.length;var a=this._warp.offsetHeight,s=this._warp.offsetWidth;this.warpH=a,this.warpW=s;var t=this._main[0].cloneNode(!0),e=this._main[this._main.length-1].cloneNode(!0);this._warp.appendChild(t),this._warp.prepend(e),this._warp.style.cssText="transform: translate3d(0, 0, 0); transition: none",this._warp.childNodes.forEach(function(t,e){1===t.nodeType&&(t.style.height=a+"px",n.attrs.horizontal?t.style.left=s*(e/2-1)+"px":t.style.top=a*(e/2-1)+"px",t.index=e/2-1)}),this.attrs.touch&&this.handleMoveEventListener(),this.attrs.play&&this.handlePlayer(),this.attrs.point&&(this.createPoint(),this.handlePoint(this.index))}},{key:"createPoint",value:function(){var n=this,t=document.createElement("style"),e=this._warp.parentNode;e.style.position="relative";var a=document.createElement("div");a.className="point-dom-"+this.attrs.horizontal,this._main.forEach(function(t,e){a.innerHTML+="<span class='point-list-"+n.attrs.horizontal+"' data-tap='"+e+"'>●</span>"}),this.attrs.horizontal?t.innerHTML="\n          .point-dom-true {\n            position: absolute;\n            bottom: 10px;\n            left: 50%;\n            transform: translate(-50%, 0);\n          }\n          .point-list-true {\n            margin-right: 5px;\n            font-size: "+this.attrs.pointSize+";\n          }\n          .point-dom-true .selected-point-list {\n            color: "+this.attrs.pointColor+";\n          }\n        ":t.innerHTML="\n        .point-dom-false {\n          position: absolute;\n          top: 50%;\n          left: 30px;\n          transform: translate(0, -50%);\n        }\n        .point-list-false {\n          margin-right: 5px;\n          display: block;\n          font-size: "+this.attrs.pointSize+";\n        }\n        .point-dom-false .selected-point-list {\n          color: "+this.attrs.pointColor+";\n        }\n      ",e.appendChild(a),e.appendChild(t),this.pointList=a.childNodes}},{key:"handleMoveEventListener",value:function(){this._warp.addEventListener("touchstart",this.handleTouchStart.bind(this)),this._warp.addEventListener("touchend",this.handleTouchEnd.bind(this))}},{key:"handleTouchStart",value:function(t){t.preventDefault(),this.attrs.startPos=t.touches[0].pageY,this.attrs.startPosX=t.touches[0].pageX,this.attrs.endPos=0,this.attrs.endPosX=0,new RegExp(this.attrs.main).test(t.target.className)?this.index=t.target.index:this.index=t.target.parentNode.index,this._warp.addEventListener("touchmove",this.handleTouchMove.bind(this)),clearInterval(this.interval)}},{key:"handleTouchMove",value:function(t){t.preventDefault(),this.attrs.endPos=t.touches[0].pageY,this.attrs.endPosX=t.touches[0].pageX,this.attrs.horizontal?this._warp.style.cssText="transform: translate3d("+(this.attrs.endPosX-this.attrs.startPosX-this.index*t.target.offsetWidth)+"px, 0, 0); transition: none":this._warp.style.cssText="transform: translate3d(0, "+(this.attrs.endPos-this.attrs.startPos-this.index*t.target.offsetHeight)+"px, 0); transition: none"}},{key:"handleTouchEnd",value:function(){var t=void 0,e=void 0;this.attrs.horizontal?(e=this.attrs.half||.5*this.warpW,t=~~(this.attrs.endPosX-this.attrs.startPosX)):(t=~~(this.attrs.endPos-this.attrs.startPos),e=this.attrs.half||.5*this.warpH),0<Math.abs(t)&&(0!==this.attrs.endPos||0!==this.attrs.endPosX)?(Math.abs(t)>=e&&(this.index=t<0?this.index+1:this.index-1),this.handleMoveList(this.index)):console.log("未拖动"),this.attrs.play&&this.handlePlayer(this.index)}},{key:"handleMoveList",value:function(t){var e=this,n=void 0,a=void 0,s=void 0;s=this.attrs.horizontal?(n=parseInt(this._warp.style.transform.slice(12)),a=-t*this.warpW,this.warpW):(n=parseInt(this._warp.style.transform.slice(16)),a=-t*this.warpH,this.warpH),this.tweenTranslateAnimate(n,a,function(){switch(t){case e._mainLen:e.handleMainMove(0),e.index=0;break;case-1:e.handleMainMove(s*(1-e._mainLen)),e.index=e._mainLen-1}e.attrs.play&&e.handlePlayer()}),this.handlePoint(t)}},{key:"handleMainMove",value:function(t){this.attrs.horizontal?this._warp.style.cssText="transform: translate3d("+t+"px, 0, 0); transition: none":this._warp.style.cssText="transform: translate3d(0, "+t+"px, 0); transition: none"}},{key:"handlePoint",value:function(e){-1===e?e=this._mainLen-1:e===this._mainLen&&(e=0),this.pointList.forEach(function(t){t.getAttribute("data-tap")===e.toString()?(t.className=t.className.replace(/selected-point-list/,""),t.className+=" selected-point-list"):t.className=t.className.replace(/\s+selected-point-list/,"")})}},{key:"handlePlayer",value:function(){var t=this;this.interval=setInterval(function(){t.index=t.index+1,t.handleMoveList(t.index)},this.attrs.time)}},{key:"tweenTranslateAnimate",value:function(n,a,s){var i=this,r=0,o=a-n;this.timer=setInterval(function(){var t,e=n+(t=++r,-o*(t/=50)*(t-2)+0);i.attrs.horizontal?(i._warp.style.transform="translate3d("+parseInt(e)+"px, 0, 0)",0<o&&parseInt(i._warp.style.transform.slice(12))>=a&&(i._warp.style.transform="translate3d("+parseInt(e)+"px, 0, 0)",clearInterval(i.timer),clearInterval(i.interval),s&&s()),o<0&&parseInt(i._warp.style.transform.slice(12))<=a&&(i._warp.style.transform="translate3d("+parseInt(e)+"px, 0, 0)",clearInterval(i.timer),clearInterval(i.interval),s&&s())):(i._warp.style.transform="translate3d(0, "+parseInt(e)+"px, 0)",0<o&&parseInt(i._warp.style.transform.slice(16))>=a&&(i._warp.style.transform="translate3d(0, "+parseInt(e)+"px, 0)",clearInterval(i.timer),clearInterval(i.interval),s&&s()),o<0&&parseInt(i._warp.style.transform.slice(16))<=a&&(i._warp.style.transform="translate3d(0, "+parseInt(e)+"px, 0)",clearInterval(i.timer),clearInterval(i.interval),s&&s()))},4)}}]),e}();